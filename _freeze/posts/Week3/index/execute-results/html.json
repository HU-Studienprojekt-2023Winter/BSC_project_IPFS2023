{
  "hash": "1fe7ca6378e8df5ac831c972da264962",
  "result": {
    "markdown": "---\ntitle: \"Week3: Spikelet development\"\nauthor: \"Tien-Cheng\"\ndate: \"2023-05-02\"\ncategories: [R-basic]\ntoc: true\nnumber-sections: true\nwebsite: \n  sidebar:\n    search: true\nformat:\n  html: \n    # code-fold: true\n    html-math-method: katex\nreference-location: margin\n---\n\n\n\n\nWelcome to the third course! During the following 2 hrs, you will learn `ggplot` and `dataframe` wrangling:\n\n::: callout-note\n1.  ggplot2 advance\n2.  \n:::\n^[This is a sidenote that was entered using a footnote.] \n## Read data and Rproject\n\n### practice dataframe with real data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv(\"data/ear_summarized.csv\")\n# data %>% str()\ndata %>% glimpse()\nnames(data)\n# extract column from dataframe\ndata$BBCH\ndata %>% unique()\n\n# summarize dataframe\nlapply(data, range)\n# turn as data frame\nlapply(data, range) %>% data.frame()\n\nsummary(data)\n```\n:::\n\n\n## Plot\n\n### GGplot2\n\nRequirements of scientific plot.\n\n1.  `axis title` with unit if there is any.\n\n2.  `legend title` full name instead of default abbreviation.\n\nFigure title.\n\n[ggplot 2](https://ggplot2.tidyverse.org) [ggplot gallery](https://r-graph-gallery.com)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot)\nlibrary(ggplot2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% \n  ggplot(aes(x=date,y=weight,color=var))+\n  geom_point()+\n  geom_line(aes(group=group))+ # link the point by group.\n  xlab(\"date of harvest\")+ #x axis title\n  ylab(\"ear weight(g)\")+   #y axis title\n  guides(color=guide_legend(title=\"Cultivar\")) #change legend title \n```\n\n::: {.cell-output-display}\n![Growth of ear weight over time.](index_files/figure-html/fig-growth-1.png){#fig-growth width=1152}\n:::\n:::\n\n\n::: callout-challenge\nuse `theme_xx()` function series to change background of the plot. Find your favorite one.\n:::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![dark theme example.](index_files/figure-html/unnamed-chunk-4-1.png){width=1152}\n:::\n:::\n\n\n## Data format overview\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# path <- getwd() %>% sub(\"posts.*\",\"data\",.)\n# dat <-read.csv(paste0(path,'/kernel_combine.csv'))\ndat <-read.csv('./data/kernel_combine.csv',\n                header = T,stringsAsFactors = F) %>%\n  dplyr::filter(tiller==\"M\")\nglimpse(dat)\n```\n:::\n\n\n# check the combination of the experimental design\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %>% group_by(car,var,nitrogen,time,rep) %>% summarise()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 227 x 5\n# Groups:   car, var, nitrogen, time [48]\n     car var     nitrogen time    rep\n   <int> <chr>   <chr>    <chr> <int>\n 1     1 Alves   n3       t1        1\n 2     1 Alves   n3       t1        2\n 3     1 Alves   n3       t1        3\n 4     1 Alves   n3       t1        4\n 5     1 Alves   n3       t1        5\n 6     1 Apertus n3       t1        1\n 7     1 Apertus n3       t1        2\n 8     1 Apertus n3       t1        4\n 9     1 Apertus n3       t1        5\n10     1 Esket   n3       t1        1\n# ... with 217 more rows\n```\n:::\n:::\n\n\n## classify spikelet based on position\n\nthe spike of the main shoot was dissected to count the total number of floret in\n\n-   basal (third-fifth spikelet from the bottom)\n\n-   central (middle spikelets)\n\n-   apical (third-fifth spikelet from the top) spikelets throughout the spike [reference](https://doi.org/10.1016/j.fcr.2020.107908)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat %<>%\n  group_by(car,var,nitrogen,time,rep) %>% \n  mutate(type=cut(spike,3) %>% as.numeric(),\n         type=case_when(type==1~\"basal\",\n                        type==2~\"central\",\n                        T~\"apical\")) %>% \n  group_by(car,var,nitrogen,time,rep,type) %>% \n  dplyr::arrange(spike) %>% \n  mutate(Fl=seq(1,n())) %>% \n  dplyr::arrange(var,nitrogen,time,rep,spike)\nglimpse(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 4,749\nColumns: 13\nGroups: car, var, nitrogen, time, rep, type [681]\n$ car          <int> 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, ~\n$ nitrogen     <chr> \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1~\n$ time         <chr> \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1~\n$ var          <chr> \"Alves\", \"Alves\", \"Alves\", \"Alves\", \"Alves\", \"Alves\", \"Al~\n$ rep          <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, ~\n$ tiller       <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M~\n$ spike        <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1,~\n$ flower       <int> 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 4, 2, 2, 2, ~\n$ kernel.full  <int> 0, 0, 1, 2, 3, 2, 2, 3, 3, 3, 2, 3, 2, 2, 1, 2, 0, 0, 0, ~\n$ kernel.half  <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~\n$ kernel.small <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~\n$ type         <chr> \"basal\", \"basal\", \"basal\", \"basal\", \"basal\", \"basal\", \"ce~\n$ Fl           <int> 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 1, 2, 3, 4, 5, 1, 2, 3, ~\n```\n:::\n:::\n\n\n## lookuptable of treatment (not yet)\n\n## basic summary of kernel development summ for single spike\n\n    Sp: total spikelet\n    Fl: maximum floret \n    sfl: total floret\n    kf: total full kernel\n    kh: total half kernel\n    ks: total small kernel\n    kp: potential kernel number \n    fr: filling rate \n    fc: potential filling rate\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum.dat <- dat %>% \n  dplyr::group_by(nitrogen,time,var,rep,tiller,type) %>% \n  dplyr::summarise(\n    Sp=max(spike),#total spikelet\n    Fl=max(flower),# maximum floret \n    sfl=sum(flower),# total floret\n    kf=sum(kernel.full),# total full kernel\n    kh=sum(kernel.half),# total half kernel\n    ks=sum(kernel.small),# total small kernel\n    kp=kf+kh,# potential kernel number \n    fr=kf/sfl,# filling rate \n    fc=kf/kp)#potential filling rate\nglimpse(sum.dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 681\nColumns: 15\nGroups: nitrogen, time, var, rep, tiller [227]\n$ nitrogen <chr> \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"n1\", \"~\n$ time     <chr> \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"t1\", \"~\n$ var      <chr> \"Alves\", \"Alves\", \"Alves\", \"Alves\", \"Alves\", \"Alves\", \"Alves\"~\n$ rep      <int> 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 1, 1, 1, 2, 2, 2~\n$ tiller   <chr> \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"M\", \"~\n$ type     <chr> \"apical\", \"basal\", \"central\", \"apical\", \"basal\", \"central\", \"~\n$ Sp       <int> 16, 6, 11, 19, 7, 13, 17, 6, 11, 19, 7, 13, 19, 7, 13, 16, 6,~\n$ Fl       <int> 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 4, 4, 4, 4~\n$ sfl      <int> 19, 18, 20, 21, 21, 24, 22, 20, 20, 21, 22, 24, 18, 21, 24, 1~\n$ kf       <int> 10, 8, 13, 14, 11, 18, 13, 11, 15, 12, 12, 17, 9, 12, 17, 2, ~\n$ kh       <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~\n$ ks       <int> 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0~\n$ kp       <int> 10, 8, 13, 14, 11, 18, 13, 11, 15, 12, 12, 17, 9, 12, 17, 2, ~\n$ fr       <dbl> 0.5263158, 0.4444444, 0.6500000, 0.6666667, 0.5238095, 0.7500~\n$ fc       <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1~\n```\n:::\n:::\n\n\n## Data wrangling and plot with facet\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlong_format <- dat %>% \n  tidyr::pivot_longer(cols=c(nitrogen,time),\n                      names_to = \"treatment\",\n                      values_to = \"levels\") %>% \n  group_by(spike,var,treatment,levels,type,rep) %>%\n  summarise(fertile_flower=max(kernel.full)) %>% \n  group_by(spike,var,treatment,levels,type) %>%\n  summarise(fertile_flower=mean(fertile_flower))\n\nlong_format%>% \n  filter(fertile_flower<10) %>% \n  ggplot(aes(fertile_flower,spike,color=type,shape=levels))+\n  geom_point()+\n  facet_grid(treatment~var)+\n  theme_classic()+\n  scale_x_continuous(limits = c(0,5),breaks=seq(0,4))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}